<!DOCTYPE html>
<html lang="pt-BR" class="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard de Controle de Demurrage</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.2/jspdf.plugin.autotable.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .active-tab { 
            border-color: #3b82f6; 
            color: #3b82f6; 
            font-weight: 600;
        }
        .dark .active-tab {
            border-color: #60a5fa;
            color: #60a5fa;
        }
        .kpi-card { transition: transform 0.2s ease, box-shadow 0.2s ease; cursor: pointer; }
        .kpi-card:hover { transform: translateY(-4px); box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1); }
        .demurrage-column { height: 65vh; overflow-y: auto; }
        .demurrage-column::-webkit-scrollbar { width: 6px; }
        .demurrage-column::-webkit-scrollbar-track { background: transparent; }
        .demurrage-column::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
        .dark .demurrage-column::-webkit-scrollbar-thumb { background: #475569; }
        .container-card { transition: box-shadow 0.2s ease; cursor: pointer; border-left-width: 4px; }
        .container-card:hover { box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1); }
        .modal { transition: opacity 0.3s ease; }
        .modal-content-wrapper { transition: all 0.3s ease; }
        .modal-open { opacity: 1 !important; pointer-events: auto !important; }
        .modal-open .modal-content-wrapper { transform: scale(1) !important; opacity: 1 !important; }
        .data-table th { padding: 10px 8px; text-align: left; font-size: 0.75rem; }
        .data-table td { padding: 10px 8px; font-size: 0.8rem; }
        .data-table tr.paid { background-color: #f0fdf4; text-decoration: line-through; color: #6b7280; }
        .dark .data-table tr.paid { background-color: #166534; color: #a1a1aa; }
        .toggle-label { transition: background-color 0.2s ease; }
        .toast-container { position: fixed; top: 1.5rem; right: 1.5rem; z-index: 9999; }
        .toast { animation: slide-in 0.5s forwards, fade-out 0.5s 4.5s forwards; }
        @keyframes slide-in { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
        @keyframes fade-out { from { opacity: 1; } to { opacity: 0; transform: translateX(100%); } }
    </style>
</head>
<body class="p-4 md:p-8 bg-slate-100 dark:bg-slate-900">
    <div class="max-w-full mx-auto">
        
        <header class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6">
            <div>
                <h1 class="text-3xl font-extrabold text-gray-800 dark:text-slate-100" data-translate-key="main_title">DASHBOARD DE CONTROLE DE DEMURRAGE</h1>
                <p id="last-update" class="text-gray-500 dark:text-slate-400 mt-1" data-translate-key="upload_prompt_initial">Carregue sua planilha para começar</p>
            </div>
            <div class="flex items-center space-x-2 mt-4 md:mt-0">
                 <div class="flex items-center space-x-0 rounded-lg shadow-md">
                    <button id="settings-btn" class="hidden cursor-pointer bg-gray-500 hover:bg-gray-600 dark:bg-gray-600 dark:hover:bg-gray-500 text-white px-4 h-[44px] rounded-l-lg transition-all duration-300 font-semibold flex items-center" title="Configurações">
                        <i class="fas fa-cog"></i>
                    </button>
                    <button id="clear-data-btn" class="hidden cursor-pointer bg-yellow-500 hover:bg-yellow-600 dark:bg-yellow-600 dark:hover:bg-yellow-500 text-white px-4 h-[44px] rounded-r-lg transition-all duration-300 font-semibold flex items-center">
                        <i class="fas fa-trash-alt mr-2"></i> <span data-translate-key="clear_data_btn">Limpar Dados</span>
                    </button>
                </div>
                <div class="flex items-center space-x-2 rounded-lg shadow-md">
                    <button id="theme-toggle-btn" class="cursor-pointer bg-slate-700 hover:bg-slate-600 dark:bg-slate-600 dark:hover:bg-slate-500 text-white px-4 h-[44px] rounded-lg transition-all duration-300 font-semibold flex items-center w-[52px] justify-center">
                        <i id="theme-toggle-icon" class="fas fa-moon"></i>
                    </button>
                </div>
                <label for="file-upload" class="cursor-pointer bg-blue-600 hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-400 text-white px-4 py-2.5 rounded-lg shadow-md transition-all duration-300 font-semibold flex items-center h-[44px]">
                    <i class="fas fa-upload mr-2"></i> <span data-translate-key="upload_btn">Carregar XLSX</span>
                </label>
                <input id="file-upload" type="file" class="hidden" accept=".xlsx, .xls">
            </div>
        </header>

        <div id="main-content-area" class="hidden">
            <div class="mb-6 border-b border-gray-200 dark:border-slate-700">
                <nav class="flex space-x-4 -mb-px" aria-label="Tabs">
                    <button class="tab-btn active-tab" data-tab="dashboard"><i class="fas fa-th-large mr-2"></i><span data-translate-key="tab_dashboard">Dashboard</span></button>
                    <button class="tab-btn" data-tab="paid-demurrage"><i class="fas fa-money-check-alt mr-2"></i><span data-translate-key="tab_paid_demurrage">Demurrage Pago</span></button>
                </nav>
            </div>
            
            <div id="tab-panel-dashboard" class="tab-panel">
                <div id="kpi-container" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-6 mb-6">
                    <div class="kpi-card p-5" data-kpi-category="demurrage"><p class="text-sm font-medium text-red-600" data-translate-key="kpi_demurrage_title">Com Demurrage</p><p id="demurrage-count" class="text-4xl font-extrabold text-red-600">0</p><p class="text-xs text-gray-500 dark:text-slate-400" data-translate-key="kpi_demurrage_subtitle">Contêineres com prazo vencido</p></div>
                    <div class="kpi-card p-5" data-kpi-tab="paid-demurrage"><p class="text-sm font-medium text-amber-600" data-translate-key="kpi_returned_late_title">Devolvidos com Demurrage</p><p id="returned-late-count" class="text-4xl font-extrabold text-amber-600">0</p><p class="text-xs text-gray-500 dark:text-slate-400" data-translate-key="kpi_returned_late_subtitle">Contêineres entregues com custo</p></div>
                    <div class="kpi-card p-5" data-kpi-category="risk"><p class="text-sm font-medium text-orange-600" data-translate-key="kpi_risk_title">Em Risco (Próx. 15 dias)</p><p id="risk-count" class="text-4xl font-extrabold text-orange-600">0</p><p class="text-xs text-gray-500 dark:text-slate-400" data-translate-key="kpi_risk_subtitle">Contêineres com prazo vencendo</p></div>
                    <div class="kpi-card p-5" data-kpi-category="returned"><p class="text-sm font-medium text-green-600" data-translate-key="kpi_returned_title">Devolvidos no Prazo</p><p id="returned-count" class="text-4xl font-extrabold text-green-600">0</p><p class="text-xs text-gray-500 dark:text-slate-400" data-translate-key="kpi_returned_subtitle">Contêineres retornados sem custo</p></div>
                    <div class="kpi-card p-5"><p class="text-sm font-medium text-gray-600 dark:text-slate-300" data-translate-key="kpi_cost_title">Custo Total de Demurrage</p><p id="total-cost" class="text-4xl font-extrabold text-gray-800 dark:text-slate-100">$0</p><p class="text-xs text-gray-500 dark:text-slate-400" data-translate-key="kpi_cost_subtitle">*Custo de contêineres ativos e já devolvidos</p></div>
                </div>

                <main id="demurrage-board" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                    <div id="col-demurrage"><h2 class="text-lg font-bold text-red-700 dark:text-red-400 mb-3 p-2 bg-red-100 dark:bg-red-900/30 rounded-md" data-translate-key="board_title_demurrage">COM DEMURRAGE (ATRASADO)</h2><div class="demurrage-column space-y-3"></div></div>
                    <div id="col-high-risk"><h2 class="text-lg font-bold text-orange-700 dark:text-orange-400 mb-3 p-2 bg-orange-100 dark:bg-orange-900/30 rounded-md" data-translate-key="board_title_high_risk">ALTO RISCO (VENCE ≤ 15 DIAS)</h2><div class="demurrage-column space-y-3"></div></div>
                    <div id="col-medium-risk"><h2 class="text-lg font-bold text-yellow-700 dark:text-yellow-400 mb-3 p-2 bg-yellow-100 dark:bg-yellow-900/30 rounded-md" data-translate-key="board_title_medium_risk">ATENÇÃO (VENCE ≤ 30 DIAS)</h2><div class="demurrage-column space-y-3"></div></div>
                    <div id="col-low-risk"><h2 class="text-lg font-bold text-green-700 dark:text-green-400 mb-3 p-2 bg-green-100 dark:bg-green-900/30 rounded-md" data-translate-key="board_title_low_risk">SEGURO (> 30 DIAS)</h2><div class="demurrage-column space-y-3"></div></div>
                </main>
            </div>
             <div id="tab-panel-paid-demurrage" class="tab-panel hidden">
                <div id="paid-demurrage-summary" class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                    <div class="kpi-card p-5"><p class="text-sm font-medium text-red-600" data-translate-key="summary_total_cost_returned">Custo Total (Devolvidos)</p><p id="summary-total-cost" class="text-4xl font-extrabold text-red-600">_</p></div>
                    <div class="kpi-card p-5"><p class="text-sm font-medium text-green-600" data-translate-key="summary_paid">Total Pago</p><p id="summary-paid-cost" class="text-4xl font-extrabold text-green-600">_</p></div>
                    <div class="kpi-card p-5"><p class="text-sm font-medium text-orange-600" data-translate-key="summary_unpaid">Total Pendente</p><p id="summary-unpaid-cost" class="text-4xl font-extrabold text-orange-600">_</p></div>
                </div>
                <div id="paid-demurrage-table-container" class="bg-white dark:bg-slate-800 p-4 rounded-lg shadow overflow-x-auto"></div>
            </div>
        </div>
        
        <div id="placeholder" class="text-center py-20 bg-white dark:bg-slate-800 rounded-lg shadow">
            <i class="fas fa-hourglass-half text-6xl text-gray-300 dark:text-slate-600 mb-4"></i>
            <h2 class="text-2xl font-semibold text-gray-600 dark:text-slate-300" data-translate-key="placeholder_title">Aguardando arquivo...</h2>
            <p class="text-gray-400 dark:text-slate-500" data-translate-key="placeholder_subtitle">Selecione a planilha para iniciar a análise de demurrage.</p>
        </div>
    </div>
     <div id="details-modal" class="modal hidden fixed inset-0 bg-gray-900 bg-opacity-70 flex items-center justify-center z-50 p-4 opacity-0 pointer-events-none"><div class="modal-content-wrapper bg-white dark:bg-slate-800 rounded-lg shadow-xl w-11/12 max-w-4xl max-h-[90vh] flex flex-col scale-95 opacity-0"><div class="p-4 border-b dark:border-slate-700 flex justify-between items-center"><div id="modal-header-content"></div><button id="modal-close-btn" class="text-gray-400 hover:text-gray-600"><i class="fas fa-times fa-2x"></i></button></div><div id="modal-body" class="p-6 flex-grow overflow-y-auto"></div></div></div>
    <div id="list-modal" class="modal hidden fixed inset-0 bg-gray-900 bg-opacity-70 flex items-center justify-center z-50 p-4 opacity-0 pointer-events-none"><div class="modal-content-wrapper max-w-6xl bg-white dark:bg-slate-800 rounded-lg shadow-xl w-11/12 max-h-[90vh] flex flex-col scale-95 opacity-0"><div class="p-4 border-b dark:border-slate-700 flex justify-between items-center"><h2 id="list-modal-title" class="text-2xl font-bold text-gray-800 dark:text-slate-100"></h2><button id="list-modal-close-btn" class="text-gray-400 hover:text-gray-600"><i class="fas fa-times fa-2x"></i></button></div><div id="list-modal-body" class="p-4 flex-grow overflow-y-auto"></div></div></div>
    <div id="rates-modal" class="modal hidden fixed inset-0 bg-gray-900 bg-opacity-70 flex items-center justify-center z-50 p-4 opacity-0 pointer-events-none"><div class="modal-content-wrapper max-w-2xl bg-white dark:bg-slate-800 rounded-lg shadow-xl w-11/12 flex flex-col scale-95 opacity-0"><div class="p-4 border-b dark:border-slate-700 flex justify-between items-center"><h2 class="text-2xl font-bold text-gray-800 dark:text-slate-100" data-translate-key="rates_modal_title">Taxas de Demurrage por Armador</h2><button id="rates-modal-close-btn" class="text-gray-400 hover:text-gray-600"><i class="fas fa-times fa-2x"></i></button></div><div id="rates-modal-body" class="p-6 flex-grow overflow-y-auto space-y-4"></div><div class="p-4 border-t dark:border-slate-700 flex justify-end items-center"><p class="text-sm text-gray-500 dark:text-slate-400 mr-auto" data-translate-key="rates_modal_footer_note">Valores não definidos usarão a taxa padrão.</p><button id="rates-modal-save-btn" class="bg-blue-600 text-white px-5 py-2 rounded-md shadow-sm hover:bg-blue-700 font-semibold" data-translate-key="save_btn">Salvar</button></div></div></div>

    <div id="toast-container" class="fixed top-5 right-5 z-[100]"></div>
    <div id="loading-overlay" class="hidden fixed inset-0 bg-white/70 dark:bg-slate-900/70 flex items-center justify-center z-[200]"></div>

    <script>
        // --- This script tag is intentionally left blank. ---
        // --- All JavaScript logic has been moved to index.tsx and will be bundled. ---
    </script>
</body>
</html>
